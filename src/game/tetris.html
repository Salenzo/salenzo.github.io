<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
    <meta name="GENERATOR" content="Microsoft FrontPage 6.0" />
    <meta name="ProgId" content="FrontPage.Editor.Document" />
    <style>
      TD {
        width: 20;
        height: 20;
      }
    </style>
  </head>

  <body
    bgcolor="#000000"
    text="#0099FF"
    link="#0099FF"
    vlink="#0099FF"
    alink="#0099FF"
    style="line-height: 150%;"
  >
    <script>

      	document.body.innerHTML += '<DIV id="stage" style="position: absolute; top: 0; left: 0;"></DIV>' //锟斤拷戏锟斤拷锟斤拷
      	document.body.innerHTML += '<div id="element_stage" style="position: absolute; top: 3; left: 500; width: 159; height: 152"></div>';//预锟皆憋拷
      	document.body.innerHTML += '<div id="obj_stage" style="position: absolute; top: 0; left: 132; display: block; z-index: 100"></div>';//锟筋动锟斤拷


      	var element_html = '<table id="element_table" border="1" width="100%" height="100%" bordercolor="#000000" cellspacing="0" cellpadding="0">';
      	var obj_html     = '<table id="obj_table" border="1" bordercolor="#000000" cellspacing="0" cellpadding="0">';



      	for(h=0;h<=4;h++)       //-------锟斤拷锟斤拷预锟皆憋拷 锟斤拷 锟筋动锟斤拷-------//
      	{
      		element_html += "<tr>";
      		obj_html     += "<tr>";


      		for(w=0;w<=4;w++)
      		{
      			element_html += "<td  bgcolor=\"\" value=\"0\"></td>";
      			obj_html += "<td bgcolor=\"\" value=\"0\"></td>";

      		}

      		element_html += "</tr>";
      		obj_html += "</tr>";
      	}

      	element_html += "</table>";
      	obj_html += "</table>";


      	element_stage.innerHTML = element_html;
      	obj_stage.innerHTML     = obj_html;

      	document.body.innerHTML +='<p align="right">锟斤拷 <span id="game_number">1</span> 锟斤拷</p><p align="right">锟斤拷锟斤拷锟斤拷锟斤拷<br><span id="game_line">0</span></p><p align="right">锟斤拷戏锟矫凤拷<br><span id="game_score">0</span></p>p align="right">锟斤拷</p><p align="right"><a href="javascript:;" value="0" onclick="If_play(this.value)">锟斤拷  始</a> </p> '



      	var map = new Array(       //锟斤拷图

      		"111000000000000111","111000000000000111","111000000000000111","111000000000000111","111000000000000111",
      		"111000000000000111","111000000000000111","111000000000000111","111000000000000111","111000000000000111",
      		"111000000000000111","111000000000000111","111000000000000111","111000000000000111","111000000000000111",
      		"111000000000000111","111000000000000111","111000000000000111","111000000000000111","111000000000000111",
      		"222222222222222222","222222222222222222"
      	);

      //-------------L------------//	//锟斤拷员锟斤拷
      	var L1 = new Array("0000","1000","1000","1100");

      	var L2 = new Array("0000","0000","0010","1110");

      	var L3 = new Array("0000","0110","0010","0010");

      	var L4 = new Array("0000","1110","1000","0000");
      //-------------L-------------//


      //-------------J------------//
      	var J1 = new Array("0000","0010","0010","0110");

      	var J2 = new Array("0000","0000","1110","0010");

      	var J3 = new Array("0000","1100","1000","1000");

      	var J4 = new Array("0000","0000","1000","1110");
      //-------------J-------------//


      //-------------Z------------//
      	var Z1 = new Array("0000","0000","1100","0110");

      	var Z2 = new Array("0000","0100","1100","1000");

      	var Z3 = new Array("0000","0000","1100","0110");

      	var Z4 = new Array("0000","0100","1100","1000");
      //-------------Z-------------//



      //-------------S------------//
      	var S1 = new Array("0000","0000","0110","1100");

      	var S2 = new Array("0000","0100","0110","0010");

      	var S3 = new Array("0000","0000","0110","1100");

      	var S4 = new Array("0000","0100","0110","0010");
      //-------------S-------------//


      //-------------T------------//
      	var T1 = new Array("0000","0000","0100","1110");

      	var T2 = new Array("0000","0010","0110","0010");

      	var T3 = new Array("0000","1110","0100","0000");


      	var T4 = new Array("0000","1000","1100","1000");
      //-------------T-------------//


      //-------------M------------//
      	var M1 = new Array("0000","0000","1100","1100");

      	var M2 = new Array("0000","0000","1100","1100");

      	var M3 = new Array("0000","0000","1100","1100");

      	var M4 = new Array("0000","0000","1100","1100");
      //-------------M-------------//


      //-------------I------------//
      	var I1 = new Array("1000","1000","1000","1000");

      	var I2 = new Array("0000","0000","0000","1111");

      	var I3 = new Array("0010","0010","0010","0010");

      	var I4 = new Array("0000","0000","0000","1111");
      //-------------I-------------//


      //-------------锟斤拷员位锟矫憋拷-------------//

      	var players = new Array("I","J","T","L","Z","S","M");

      	//----锟斤拷锟缴碉拷图--------//


      	function get_color(color_value)
      	{
      		if(color_value=="1"||color_value=="2")
      			return "#000080";
      		else
      			return "#000000";
      	}




      	var map_html = '<table id="map_table" border="1" cellspacing="0" cellpadding="0" bgcolor="#000000" bordercolor="#000000">';

      	for(h=0;h<map.length;h++)
      	{
      		map_html+="<tr>"

      		for(w=0;w<map[0].length;w++)
      		{
      			map_html+="<td value=\""+map[h].charAt(w)+"\" bgcolor=\""+get_color(map[h].charAt(w))+"\">"


      		}

      		map_html +="</tr>"
      	}

      	map_html+="</table>"

      	stage.innerHTML = map_html

      	//----锟斤拷锟缴碉拷图--------//
      /****************************************** 锟斤拷锟斤拷锟斤拷准锟斤拷锟侥达拷锟斤拷****************************************************/


      	function Y_X(y,x) //锟斤拷锟矫角的讹拷锟斤拷
      	{
      		this.x = x;
      		this.y = y;
      	}

      	var game_l_u_angle = new Y_X(0,6);      //锟斤拷锟斤拷锟绞� 锟斤拷锟较斤拷 锟斤拷  锟斤拷锟较斤拷 锟斤拷 x y 锟斤拷锟斤拷
      	var game_r_d_angle = new Y_X(3,9);

      	var left_up_angle = new Y_X(game_l_u_angle.y,game_l_u_angle.x); //锟斤拷锟节碉拷 锟斤拷锟较角碉拷 x y 锟斤拷锟斤拷
      	var right_down_angle = new Y_X(game_r_d_angle.y,game_r_d_angle.x); //锟斤拷锟节碉拷 锟斤拷锟较斤拷 锟斤拷 x y 锟斤拷锟斤拷

      	var block_color_1 = "#0099FF"; //锟斤拷锟节的凤拷锟斤拷锟斤拷锟缴�
      	var block_color_0 = "";        //锟斤拷锟斤拷锟斤拷色

      	var map_color_1 = "#000080"; //map 锟斤拷锟斤拷锟斤拷色 1
      	var map_color_0 = "#000000";        //锟斤拷锟斤拷锟斤拷色 0

      	var block_width = "22"; //锟斤拷锟斤拷 锟斤拷 锟竭筹拷
      	var block_height = "20";

      	var game_speed = 540 //锟斤拷戏锟劫讹拷
      	var game_max_speed = Math.floor(game_speed/20);

      	var SHAPES = new Array("I","M","Z","J","T","S","L"); // 锟斤拷锟斤拷锟斤拷状锟斤拷锟斤拷

      	var shape_now = SHAPES[returnONE(6)];  //锟斤拷锟节的凤拷锟斤拷锟斤拷状
      	var shape_will = SHAPES[returnONE(6)]; //锟斤拷锟斤拷锟侥凤拷锟斤拷锟斤拷状

      	var shape_num = 1;

      	var obj_start_left = 132;     //锟斤拷锟斤拷锟斤拷始位锟斤拷
      	var obj_start_top  = 0;


      	var can_move_block = false;  //锟斤拷锟斤拷锟矫伙拷锟角凤拷锟斤拷锟斤拷贫锟斤拷锟斤拷锟�
      	var can_play       = false;  //锟斤拷戏锟侥匡拷始

      	var one_score  = 10;  //一锟斤拷锟侥得凤拷
      	var block_score = 4*one_score //一锟斤拷锟斤拷锟斤拷牡梅锟�
      	var line_score  =  12*one_score //一锟叫的得凤拷

      /*******************************************锟斤拷锟斤拷锟斤拷锟斤拷锟斤拷********************锟斤拷锟斤拷锟角撅拷锟斤拷锟斤拷锟斤拷 锟斤拷锟斤拷************************/

      //------------锟斤拷锟斤拷锟斤拷锟斤拷锟斤拷--------------------//

      		function returnONE(JSnum){

      			JSnum = Math.round(JSnum*Math.random()*100/100);

      			return JSnum;
      		}

      //--------------锟斤拷锟斤拷锟斤拷锟�-----------------------//

      	function return_TOP()
      	{
      		var block_value = "";

      		for(h=0;h<4;h++)
      		{
      			for(w=0;w<4;w++)
      			{
      				block_value = obj_table.rows(h).cells(w).value;

      				if(block_value=="1")
      					return (h + left_up_angle.y)
      			}
      		}
      	}



      //---------锟斤拷锟斤拷 obj 锟斤拷示 指锟斤拷 锟斤拷 type+num 锟斤拷锟斤拷	-----------//

      	function set_block(obj,type,num)
      	{
      		var block = eval(type+num); //锟斤拷锟� 指锟斤拷 锟斤拷锟斤拷

      		var block_value = "";
      		var block_color = "";

      		for(h=0;h<block.length;h++)
      		{
      			for(w=0;w<block[0].length;w++)
      			{
      				block_value = block[h].charAt(w);
      				block_color = eval("block_color_" + block_value );

      				with(obj.rows(h).cells(w))
      				{
      					bgColor = block_color;
      					value   = block_value;
      				}
      			}
      		}

      	}


      //-------------使 obj 锟斤拷锟斤拷贫锟�--------------//

      	function move_block_by(x,y)
      	{
      		left_up_angle.x += x;
      		left_up_angle.y += y;

      		right_down_angle.x += x;
      		right_down_angle.y += y;

      		obj_stage.style.pixelLeft = left_up_angle.x * block_width;
      		obj_stage.style.pixelTop  = left_up_angle.y * block_height;


      	}


      //---------------锟叫讹拷 锟角凤拷 锟斤拷锟斤拷 锟狡讹拷 锟斤拷锟斤拷锟� -------------//

      	function If_can_move(l_x,l_y,r_x,r_y) //锟斤拷锟节筹拷锟斤拷锟叫讹拷
      	{

      		var obj_value = "";
      		var map_value = "";

      		var checker = 0;



      		for(obj_h=0,h=l_y;h<=r_y;h++,obj_h++)
      		{
      			for(obj_w=0,w=l_x;w<=r_x;w++,obj_w++)
      			{
      				obj_value = obj_table.rows(obj_h).cells(obj_w).value;
      				map_value = map_table.rows(h).cells(w).value

      				checker = parseInt(obj_value)+parseInt(map_value);


      				if(map_value=="2")
      				{
      					if(checker>2)
      						return false;
      				}
      				else
      				{

      					if(checker>1)
      						return false;
      				}
      			}
      		}


      		return true;
      	}


      	function test_block(){} //锟斤拷锟斤拷锟斤拷锟斤拷锟斤拷block value 锟斤拷 锟斤拷锟皆讹拷锟斤拷

      	var tester = null;

      	function If_can_move_test(l_x,l_y,r_x,r_y) //锟斤拷锟节憋拷锟斤拷锟叫讹拷
      	{

      		var obj_value = "";
      		var map_value = "";

      		var checker = 0;



      		for(obj_h=0,h=l_y;h<=r_y;h++,obj_h++)
      		{
      			for(obj_w=0,w=l_x;w<=r_x;w++,obj_w++)
      			{
      				obj_value = eval("tester.value_"+obj_h+"_"+obj_w);
      				map_value = map_table.rows(h).cells(w).value


      				checker = 	parseInt(obj_value) + parseInt(map_value);

      				if(map_value=="2")
      				{
      					if(checker>2)
      						return false;
      				}
      				else
      				{

      					if(checker>1)
      						return false;
      				}
      			}
      		}


      		return true;
      	}



      //--------------锟斤拷锟矫憋拷锟斤拷锟斤拷色----------------------//

      	function set_map_bgcolor(l_x,l_y,r_x,r_y)
      	{

      		var obj_value = "";


      		for(obj_h=0,h=l_y;h<=r_y;h++,obj_h++)
      		{
      			for(obj_w=0,w=l_x;w<=r_x;w++,obj_w++)
      			{
      				obj_value = obj_table.rows(obj_h).cells(obj_w).value;

      				if(obj_value=="1")
      				{
      						with(map_table.rows(h).cells(w))
      						{
      							value = obj_value;
      							bgColor = eval("block_color_"+obj_value);

      						}
      				}

      			}
      		}


      	}

      //---------------锟斤拷锟斤拷 锟斤拷 --------------------------------//

      	function delete_line(l_y,r_y)
      	{

      		var value_1_num = 0; //为 1 锟侥匡拷锟斤拷
      		var can_delete_num = map[0].length;     //锟斤拷锟斤拷删锟斤拷锟斤拷 value = 1 锟侥★拷block 锟斤拷锟斤拷锟斤拷

      		var can_delete = true;

      		var the_block_value = "";    //锟斤拷锟节碉拷block锟斤拷value

      		for(h=l_y;h<=r_y;h++)
      		{
      			for(w=0;w<can_delete_num;w++)
      			{
      				the_block_value = map_table.rows(h).cells(w).value

      				if(the_block_value=="0"||the_block_value=="2")
      				{
      					can_delete = false;
      				}
      			}

      			if(can_delete) //锟斤拷锟饺拷锟轿�1锟侥伙拷
      			{

      				map_table.deleteRow(h);
      				map_table.insertRow(0);

      				for(w=0;w<map[0].length;w++)
      				{
      					map_table.rows(0).insertCell();
      					map_table.rows(0).cells(w).value = map[0].charAt(w);
      					map_table.rows(0).cells(w).bgColor = eval("map_color_"+map[0].charAt(w));
      				}

      				game_line.innerText =  ""+ (parseInt(game_line.innerText) + 1) + "";
      				game_score.innerText = ""+ (parseInt(game_score.innerText) + line_score) + "";

      			}

      			can_delete = true;

      		}

      	}

      //--------------锟斤拷锟斤拷 锟狡讹拷 锟斤拷锟斤拷锟斤拷 down ----------------//

      	function down_block()
      	{
      		if(!can_play)
      			return;

      		var check_l_y = left_up_angle.y + 1;
      		var check_r_y = right_down_angle.y + 1;

      		var judger = If_can_move(left_up_angle.x,check_l_y,right_down_angle.x,check_r_y);


      		if(judger)
      		{
      			move_block_by(0,1);


      			setTimeout("down_block()",game_speed)
      		}
      		else
      		{
      			can_move_block = false;

      			var block_top = return_TOP();

      			if(block_top<=(game_l_u_angle.y+2))
      			{
      				if(confirm("锟斤拷戏锟斤拷锟斤拷锟斤拷锟角凤拷锟斤拷锟斤拷锟�"))
      				{
      					window.location.reload();
      				}
      				else
      				{
      					return;
      				}
      			}
      			else
      			{

      				set_map_bgcolor(left_up_angle.x,left_up_angle.y,right_down_angle.x,right_down_angle.y) //锟斤拷锟矫憋拷锟斤拷锟斤拷色锟斤拷value

      				game_score.innerText = ""+ (parseInt(game_score.innerText) + block_score) + "";

      					if(parseInt(game_score.innerText)>=(parseInt(game_number.innerText)*20000)) //锟斤拷锟斤拷锏斤拷锟斤拷值姆锟斤拷锟�
      					{
      						game_number.innerText = ""+(parseInt(game_number.innerText)+1)+"";

      						game_speed = game_speed - 60;

      						if(game_speed <=0 )
      						{
      							game_speed = 540 - (parseInt(game_number.innerText)-1)*60;

      							if(game_speed < 0)
      							{
      								alert("Win All");
      								return;
      							}
      						}

      						game_max_speed = Math.floor(game_speed/20);

      					}

      					obj_stage.style.display = "none";

      					delete_line(left_up_angle.y,right_down_angle.y);


      					shape_now = shape_will;
      					shape_will = SHAPES[returnONE(6)];
      					shape_num =1;

      					set_block(obj_table,shape_now,shape_num);
      					set_block(element_table,shape_will,shape_num);

      					left_up_angle.x = game_l_u_angle.x;
      					left_up_angle.y = game_l_u_angle.y;
      					right_down_angle.x = game_r_d_angle.x;
      					right_down_angle.y = game_r_d_angle.y;

      		         		obj_stage.style.pixelLeft = left_up_angle.x * block_width;
      					obj_stage.style.pixelTop  = left_up_angle.y * block_height;

      					obj_stage.style.display = "block";
      					can_move_block = true;

      					setTimeout("down_block()",game_speed);


      			}

      		}
      	}

      //-------------- 锟斤拷取 锟矫伙拷锟斤拷锟斤拷 锟斤拷锟斤拷 --------------	//



      	function document.onkeydown()
      	{

      		if(!can_play) //锟斤拷锟斤拷锟斤拷锟斤拷妫拷顺锟�
      			return;

      		if(!can_move_block) //锟斤拷锟斤拷锟斤拷锟斤拷贫锟斤拷锟斤拷锟斤拷顺锟�
      			return;

      		var key_code = event.keyCode;

      		if(key_code == 37)
      		{
      			var check_l_x = left_up_angle.x - 1;
      			var check_r_x = right_down_angle.x - 1;

      			var judger= If_can_move(check_l_x,left_up_angle.y,check_r_x,right_down_angle.y);

      			if(judger)
      				move_block_by(-1,0);
      			else
      				return;

      		}

      		if(key_code == 39)
      		{
      			var check_l_x = left_up_angle.x + 1;
      			var check_r_x = right_down_angle.x + 1;


      			var judger= If_can_move(check_l_x,left_up_angle.y,check_r_x,right_down_angle.y);

      			if(judger)
      				move_block_by(1,0);
      			else
      				return;
      		}

      		if(key_code == 38)
      		{
      			shape_num++;

      			if(shape_num>4)
      				shape_num = 1;

      			tester = null
      			tester = new test_block();

      			var test_shape = eval(shape_now + shape_num);



      			for(h=0;h<test_shape.length;h++)
      			{
      				for(w=0;w<test_shape[0].length;w++)
      				{
      					eval("tester.value_"+h+"_"+w+"=test_shape["+h+"].charAt("+w+")");

      				}
      			}

      			var judger = If_can_move_test(left_up_angle.x,left_up_angle.y,right_down_angle.x,right_down_angle.y)


      			if(!judger)
      			{
      				shape_num--;
      			}
      			else
      			{
      				set_block(obj_table,shape_now,shape_num);
      			}



      		}

      		if(key_code == 40)
      		{
      			game_speed = game_max_speed;
      		}
      	}

      	function document.onkeyup()
      	{
      		game_speed = 540 - (parseInt(game_number.innerText)-1)*60;

      	}


      //-----------------锟斤拷戏锟斤拷锟斤拷-----------------------////


      	function start_game(){   //锟斤拷戏锟斤拷始

      		can_play = true;
      		can_move_block =true;


      		set_block(obj_table,shape_now,shape_num);
      		set_block(element_table,shape_will,shape_num);
       		down_block();
      	}

      	function pause_game() //锟斤拷停 锟斤拷戏
      	{
      		can_play = false;
      		can_move_block =false;
      	}

      	function If_play(play_value)
      	{
      		if(play_value=="0")  //锟斤拷锟斤拷歉湛锟绞�
      		{
      			start_game();

      			event.srcElement.value = "1";
      			event.srcElement.innerText = "锟斤拷  停"

      		}
      		if(play_value=="1")
      		{
      			pause_game();

      			event.srcElement.value = "2";
      			event.srcElement.innerText = "锟斤拷  始"
      		}
      		if(play_value == "2")
      		{
      			can_play = true;
      			can_move_block =true;

               		down_block();

      			event.srcElement.value = "1";
      			event.srcElement.innerText = "锟斤拷  停";
      		}
      	}
    </script>
  </body>
</html>
